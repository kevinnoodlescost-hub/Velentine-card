<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thiá»‡p Valentine</title>

  <style>
    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --cardW: min(860px, calc(100vw - 28px));
      --radius: clamp(14px, 2.8vw, 22px);
      --pad: clamp(16px, 3.8vw, 36px);
      --h1: clamp(22px, 3.6vw, 36px);
      --h2: clamp(18px, 3vw, 28px);
      --p:  clamp(14px, 2.1vw, 18px);
      --btn: clamp(14px, 2.1vw, 16px);
      --shadow: 0 12px 34px rgba(0,0,0,0.22);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      text-align:center;
    }

    /* Tim ná»n */
    .heart{
      position:fixed;
      z-index:1;
      pointer-events:none;
      opacity:0;
      will-change:transform, opacity;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
    }
    @keyframes floatUp{
      0%   { transform: translate(var(--x0), 110vh) rotate(0deg); opacity:0; }
      12%  { opacity:1; }
      100% { transform: translate(var(--x1), -20vh) rotate(360deg); opacity:0; }
    }

    /* áº¢nh ná»n bay lÆ¡ lá»­ng */
    .floatImg{
      position:fixed;
      z-index:2;               /* > hearts (1) vÃ  < stage/panel (3) */
      pointer-events:none;
      opacity:0;
      will-change:transform, opacity;
      filter: drop-shadow(0 10px 24px rgba(0,0,0,0.18));
      animation: floatImgUp linear forwards;
      transform: translate(var(--x0), 110vh) rotate(var(--r0));
      border-radius: 16px;
    }
    @keyframes floatImgUp{
      0%   { transform: translate(var(--x0), 112vh) rotate(var(--r0)); opacity:0; }
      8%   { opacity: .55; }
      55%  { opacity: .55; }
      100% { transform: translate(var(--x1), -28vh) rotate(var(--r1)); opacity:0; }
    }

    .stage{ position:relative; z-index:3; width:var(--cardW); }

    .panel{
      background:#fff;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:var(--pad);
      margin: 0 auto;
    }

    .title{ font-size:var(--h1); margin:0 0 10px 0; line-height:1.15; }
    .subtitle{ font-size:var(--h2); margin:0 0 12px 0; line-height:1.25; }
    .text{ font-size:var(--p); line-height:1.7; margin:0 0 14px 0; }

    .btnRow{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      border:none;
      border-radius:999px;
      padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4.2vw, 26px);
      font-size:var(--btn);
      cursor:pointer;
      color:#fff;
      background:#ff4d6d;
      transition: transform .08s ease, opacity .2s ease;
    }
    button:hover{ opacity:.92; }
    button:active{ transform: translateY(1px); }

    .btnGhost{ background:#111; opacity:.85; }

    .scene{ display:none; }
    .scene.active{ display:block; }

    /* ===== Envelope ===== */
    .envelopeWrap{
      display:grid;
      place-items:center;
      gap:16px;
    }

    .envelope{
      width: min(640px, 96vw);
      aspect-ratio: 16/10;
      position:relative;
      border-radius:18px;
      background: #f7f2ee;
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
      overflow:hidden;
    }

    .env-body{
      position:absolute; inset:0;
      background: linear-gradient(180deg, #fff 0%, #f6efe9 100%);
    }

    .env-flap{
      position:absolute;
      left:0; right:0;
      top:-10%;
      height:65%;
      background: linear-gradient(180deg, #f0e6df 0%, #e9ddd4 100%);
      clip-path: polygon(0 0, 100% 0, 50% 80%);
      transform-origin: 50% 0%;
      transition: transform .9s ease;
      z-index: 2;
    }

    /* Stamp báº±ng áº£nh */
    .stamp{
      position:absolute;
      right:6%;
      top:10%;
      width: clamp(56px, 10vw, 92px);
      aspect-ratio: 1/1.15;
      border-radius:12px;
      overflow:hidden;
      transform: rotate(7deg);
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      user-select:none;
      background:#fff;
      z-index: 3;
      transition: opacity .35s ease, transform .35s ease;
    }
    .stamp img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    /* Seal (hÃ¬nh trÃ²n ğŸ’Œ) */
    .seal{
      position:absolute;
      left:50%;
      top:62%;
      transform: translate(-50%,-50%);
      width: clamp(44px, 8vw, 64px);
      height: clamp(44px, 8vw, 64px);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ff97aa, #ff4d6d);
      box-shadow: inset 0 0 0 4px rgba(255,255,255,0.55);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:800;
      user-select:none;
      z-index: 3;
      transition: opacity .35s ease, transform .35s ease;
    }

    /* âœ… (2) Má» THÆ¯: áº©n stamp + áº©n seal */
    .open .stamp{
      opacity: 0;
      transform: rotate(7deg) scale(0.92);
      pointer-events: none;
    }
    .open .seal{
      opacity: 0;
      transform: translate(-50%,-50%) scale(0.65);
      pointer-events: none;
    }

    .letter{
      position:absolute;
      left: 4.5%;
      right: 4.5%;
      height: 94%;
      bottom: -72%;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.18);
      padding: clamp(16px, 3.2vw, 28px);
      text-align:left;
      transition: transform 1s ease;
      overflow:hidden;
      z-index: 1;
    }

    .letterContent{
      height: 100%;
      overflow:auto;
      padding-right: 10px;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    .letterContent::-webkit-scrollbar{ width:8px; }
    .letterContent::-webkit-scrollbar-thumb{
      background: rgba(255,77,109,0.35);
      border-radius: 99px;
    }

    .letter h3{ margin:0 0 8px 0; font-size: clamp(18px, 2.8vw, 22px); }
    .letter p{ margin:0 0 12px 0; font-size: clamp(14px, 2.2vw, 17px); line-height:1.78; }
    .letter .sig{ margin-top: 10px; font-weight:700; }

    .open .env-flap{ transform: rotateX(180deg); }
    .open .letter{ transform: translateY(-86%); }

    #btnContinue{ display:none; }
    .opened #btnContinue{ display:inline-block; }

    .scrollBtns{
      position:absolute;
      right:10px;
      bottom:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      z-index:5;
    }
    .scrollBtn{
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      cursor:pointer;
      background: rgba(255,77,109,0.95);
      color:#fff;
      font-size:18px;
      line-height:40px;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      padding:0;
    }
    .scrollBtn:active{ transform: translateY(1px); }

    .scrollBtns{ opacity:0; transform: translateY(6px); pointer-events:none; transition: .2s ease; }
    .open .scrollBtns{ opacity:1; transform:none; pointer-events:auto; }

    /* Map */
    .mapGrid{
      display:grid;
      grid-template-columns: 1fr 1.18fr;
      gap: clamp(12px, 2.8vw, 18px);
      align-items:stretch;
      text-align:left;
      margin-top: 10px;
    }
    .mapBox{
      background:#fff;
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
      min-height: clamp(260px, 46vh, 420px);
    }
    iframe{ width:100%; height:100%; border:0; display:block; }
    .context{
      background: rgba(255,255,255,0.78);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.10);
    }
    .context .k{
      font-weight:800;
      margin:0 0 10px 0;
      font-size: clamp(18px, 2.6vw, 22px);
    }
    .context .text{
      font-size: clamp(14px, 2.2vw, 17px);
      line-height: 1.82;
      max-height: clamp(280px, 50vh, 440px);
      overflow: auto;
      padding-right: 10px;
    }
    .context .text::-webkit-scrollbar{ width:8px; }
    .context .text::-webkit-scrollbar-thumb{
      background: rgba(17,17,17,0.18);
      border-radius: 99px;
    }

    .photo{
      display:block;
      width: clamp(210px, 52vw, 360px);
      max-width:100%;
      height:auto;
      margin: 14px auto 0 auto;
      border-radius: clamp(12px, 2.4vw, 18px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
    }

    @media (prefers-reduced-motion: reduce){
      .heart, .floatImg{ animation:none; opacity:0; }
      .env-flap, .letter{ transition:none; }
      .letterContent{ scroll-behavior:auto; }
    }

    @media (max-width: 600px){
      .envelope{ width: 98vw; }
      .open .letter{ transform: translateY(-88%); }
      .context .text{ max-height: 52vh; }
    }
  </style>
</head>

<body>
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <div class="stage">

    <!-- SCENE 1 -->
    <section id="sceneEnvelope" class="scene active">
      <div class="panel envelopeWrap" id="envPanel">
        <h1 class="title">ğŸ“¬ A Letter For BÃ© Ká»‹t</h1>
        <p class="text">CÃ³ má»™t lÃ¡ thÆ° nhá» anh muá»‘n dÃ nh cho bÃ© yÃªuuuuu &lt;3.</p>

        <div id="envelope" class="envelope" aria-label="Phong bÃ¬ thÆ°">
          <div class="env-body"></div>
          <div class="env-flap"></div>

          <div class="stamp" aria-label="Love stamp">
            <img src="love stamp.jpg" alt="Love stamp">
          </div>

          <div class="seal">ğŸ’Œ</div>

          <div class="letter">
            <div id="letterContent" class="letterContent">
              <h3>Gá»­i bÃ© Ká»‹t,</h3>
              <p>
                Váº­y lÃ  mÃ¬nh Ä‘Ã£ Ä‘i cÃ¹ng nhau Ä‘Æ°á»£c 4 thÃ¡ng. Tá»¥i mÃ¬nh Ä‘Ã£ tráº£i qua nhá»¯ng lÃºc vui, cÃ³ lÃºc khÃ´ng
                dá»…, nhÆ°ng Ä‘iá»u tui cháº¯c nháº¥t lÃ  tui váº«n muá»‘n náº¯m tay bÃ© vÃ  cÃ¹ng Ä‘i tiáº¿p Ä‘oáº¡n Ä‘Æ°á»ng tháº­t dÃ i vá» sau.
              </p>
              <p>
                HÃ´m nay anh viáº¿t lÃ¡ thÆ° nÃ y Ä‘á»ƒ nÃ³i ráº±ng cáº£m Æ¡n vÃ¬ bÃ© Ä‘Ã£ Ä‘áº¿n vá»›i cuá»™c Ä‘á»i anh...
              </p>
              <p class="sig">â€” YÃªu em, ThÃ nh.</p>
              <div style="height:10px"></div>
            </div>

            <div class="scrollBtns" aria-label="NÃºt cuá»™n thÆ°">
              <button id="btnScrollDown" class="scrollBtn" title="Cuá»™n xuá»‘ng">â†“</button>
              <button id="btnScrollUp" class="scrollBtn" title="Cuá»™n lÃªn">â†‘</button>
            </div>
          </div>
        </div>

        <div class="btnRow">
          <button id="btnOpen">Má»Ÿ thÆ° âœ‰ï¸</button>
          <button id="btnContinue" class="btnGhost">Äá»c xong rá»“i ğŸ‘‰</button>
        </div>
      </div>
    </section>

    <!-- SCENE 2 -->
    <section id="sceneAsk" class="scene">
      <div class="panel">
        <h2 class="subtitle">BÃ© Ká»‹t cÃ³ Ä‘á»“ng Ã½ lÃ m Valentine cá»§a anh khÃ´ng? ğŸ’–</h2>
        <p class="text">KhÃ´ng chá»‰ nÄƒm nay.. mÃ  náº¿u bÃ© cho phÃ©p, cáº£ nhá»¯ng nÄƒm sau vÃ  nÄƒm sau vÃ  nÄƒm sau sau ná»¯a nhÃ©.</p>
        <div class="btnRow">
          <button id="btnYes">Äá»“ng Ã½ âœ…</button>
          <button id="btnNo" class="btnGhost">Äá»ƒ bÃ© suy nghÄ© thÃªm ğŸ˜³</button>
        </div>
        <p id="noHint" class="text" style="display:none; margin-top:12px;">
          Ai choooooooo, tui biáº¿t lÃ  em sáº½ nháº¥n vÃ´ nÃºt nÃ y trÆ°á»›c! Quay láº¡i vÃ  áº¥n Ä‘á»“ng Ã½ cho tÃ´i - ny Ä‘ang dá»±n cá»§a em -
        </p>
      </div>
    </section>

    <!-- SCENE 3 -->
    <section id="sceneMap" class="scene">
      <div class="panel">
        <h2 class="subtitle">NÆ¡i mÃ¬nh gáº·p nhau láº§n Ä‘áº§u ğŸ“</h2>
        <p class="text">Báº£n Ä‘á»“ á»Ÿ Ä‘Ã¢y, cÃ²n cÃ¢u chuyá»‡n thÃ¬ tui Ä‘á»ƒ ngay bÃªn cáº¡nh.</p>

        <div class="mapGrid">
          <div class="mapBox">
            <iframe
              id="mapFrame"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.5115795957554!2d106.65532687435655!3d10.77207498937643!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ec3c161a3fb%3A0xef77cd47a1cc691e!2sHCMC%20University%20of%20Technology%20(HCMUT)!5e0!3m2!1sen!2s!4v1770971711669!5m2!1sen!2s"
              title="Báº£n Ä‘á»“ nÆ¡i gáº·p nhau láº§n Ä‘áº§u">
            </iframe>
          </div>

          <div class="context">
            <p class="k">Chuyá»‡n cá»§a tá»¥i mÃ¬nh</p>
            <p class="text" style="margin:0;">
              ...
            </p>
            <div class="btnRow" style="justify-content:flex-start; margin-top:14px;">
              <button id="btnToFinal"> Lets gooo ğŸ‘‰</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SCENE 4 -->
    <section id="sceneFinal" class="scene">
      <div class="panel" id="finalCard">
        <h2 class="subtitle">Happy Valentine â¤ï¸</h2>
        <p class="text">
          Anh thÆ°Æ¡ng bÃ© Ká»‹t ráº¥t nhiá»u. <br>
          Cáº£m Æ¡n vÃ¬ Ä‘Ã£ Ä‘á»“ng hÃ nh cÃ¹ng anh nha bÃ© vÃ  tá»¥i mÃ¬nh
          hÃ£y Ä‘á»“ng hÃ nh cÃ¹ng nhau lÃ¢u tháº­t lÃ  lÃ¢u nha bÃ©. ThÆ°Æ¡ng em.
        </p>
        <img class="photo" src="áº£nh Ä‘Ã´i.jpg" alt="áº¢nh Ä‘Ã´i">
      </div>
    </section>

  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const sceneEnvelope = $("sceneEnvelope");
    const sceneAsk = $("sceneAsk");
    const sceneMap = $("sceneMap");
    const sceneFinal = $("sceneFinal");
    const envelope = $("envelope");
    const bgm = $("bgm");
    const envPanel = $("envPanel");
    const letterContent = $("letterContent");

    function showScene(scene){
      for (const s of [sceneEnvelope, sceneAsk, sceneMap, sceneFinal]) s.classList.remove("active");
      scene.classList.add("active");
    }

    async function tryPlayMusic(){
      try{
        bgm.volume = 0.85;
        await bgm.play();
      }catch(e){
        console.log("Autoplay blocked:", e);
      }
    }

    function rand(min, max){ return Math.random() * (max - min) + min; }

    function getNoSpawnZone(){
      const activePanel = document.querySelector(".scene.active .panel");
      const r = activePanel.getBoundingClientRect();
      const pad = Math.max(16, Math.round(Math.min(innerWidth, innerHeight) * 0.05));
      return { left:r.left-pad, right:r.right+pad, top:r.top-pad, bottom:r.bottom+pad };
    }

    function pickSpawnPoint(){
      const z = getNoSpawnZone();
      const W = innerWidth, H = innerHeight;
      for(let i=0;i<14;i++){
        const x = rand(0, W);
        const y = rand(0, H);
        const inside = (x>=z.left && x<=z.right && y>=z.top && y<=z.bottom);
        if(!inside) return {x,y};
      }
      return {x: rand(0,W), y: rand(0,40)};
    }

    function spawnHeart(){
      const {x,y} = pickSpawnPoint();
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = "â¤ï¸";

      const minSize = Math.max(16, Math.min(innerWidth, innerHeight) * 0.028);
      const maxSize = Math.max(26, Math.min(innerWidth, innerHeight) * 0.052);
      heart.style.fontSize = rand(minSize, maxSize) + "px";

      heart.style.left = x + "px";
      heart.style.top  = y + "px";

      const drift = rand(-50, 50);
      heart.style.setProperty("--x0", "0px");
      heart.style.setProperty("--x1", drift + "px");

      const isMobile = matchMedia("(max-width: 600px)").matches;
      const duration = isMobile ? rand(5.8, 7.8) : rand(6.2, 9.2);
      heart.style.animationDuration = duration + "s";

      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), duration * 1000 + 200);
    }

    const isMobile = matchMedia("(max-width: 600px)").matches;
    setInterval(spawnHeart, isMobile ? 650 : 450);

    /* âœ… áº¢nh ná»n: tÄƒng táº§n suáº¥t xuáº¥t hiá»‡n sau khi má»Ÿ thÆ° */
    const bgFiles = ["background 1.JPG", "background 2.jpg", "background 3.JPG"];
    let bgIntervalId = null;

    function createFloatingBgImage(src){
      const img = document.createElement("img");
      img.className = "floatImg";
      img.src = src;
      img.alt = "Floating background";
      img.decoding = "async";

      // Log náº¿u áº£nh khÃ´ng load Ä‘Æ°á»£c (báº¯t lá»—i tÃªn file/hoa thÆ°á»ng)
      img.onerror = () => console.log("KhÃ´ng load Ä‘Æ°á»£c áº£nh:", src, "(kiá»ƒm tra Ä‘Ãºng tÃªn file + hoa/thÆ°á»ng)");

      // size
      const base = Math.min(innerWidth, innerHeight);
      const wMin = Math.max(90, base * 0.16);
      const wMax = Math.max(160, base * 0.28);
      img.style.width = rand(wMin, wMax) + "px";
      img.style.height = "auto";

      // vá»‹ trÃ­: trÃ¡nh Ä‘Ã¨ panel
      const {x} = pickSpawnPoint();
      img.style.left = x + "px";
      img.style.top = rand(0, innerHeight * 0.35) + "px";

      // drift + rotate
      img.style.setProperty("--x0", "0px");
      img.style.setProperty("--x1", rand(-160, 160) + "px");
      img.style.setProperty("--r0", rand(-10, 10) + "deg");
      img.style.setProperty("--r1", rand(-18, 18) + "deg");

      // duration nhanh hÆ¡n Ä‘á»ƒ â€œtáº§n suáº¥t cáº£m nháº­nâ€ cao hÆ¡n
      const dur = isMobile ? rand(10, 14) : rand(12, 16);
      img.style.animationDuration = dur + "s";

      document.body.appendChild(img);
      setTimeout(() => img.remove(), dur * 1000 + 300);
    }

    function startBgLoop(){
      if(bgIntervalId) return;

      // táº¡o ngay 2-3 táº¥m cho â€œtháº¥y liá»nâ€
      createFloatingBgImage(bgFiles[0]);
      createFloatingBgImage(bgFiles[1]);
      createFloatingBgImage(bgFiles[2]);

      // rá»“i táº¡o liÃªn tá»¥c (tÄƒng táº§n suáº¥t á»Ÿ Ä‘Ã¢y)
      const everyMs = isMobile ? 1400 : 1000;  // muá»‘n dÃ y hÆ¡n ná»¯a: giáº£m sá»‘ nÃ y
      bgIntervalId = setInterval(() => {
        const pick = bgFiles[Math.floor(Math.random() * bgFiles.length)];
        createFloatingBgImage(pick);
      }, everyMs);
    }

    // ===== Flow =====
    $("btnOpen").addEventListener("click", async () => {
      envelope.classList.add("open");
      envPanel.classList.add("opened");
      await tryPlayMusic();

      if(letterContent) letterContent.scrollTop = 0;

      // báº­t ná»n bay (táº§n suáº¥t cao)
      startBgLoop();
    });

    $("btnContinue").addEventListener("click", () => showScene(sceneAsk));
    $("btnNo").addEventListener("click", () => $("noHint").style.display = "block");
    $("btnYes").addEventListener("click", () => showScene(sceneMap));
    $("btnToFinal").addEventListener("click", () => showScene(sceneFinal));

    function scrollLetter(delta){
      if(!letterContent) return;
      letterContent.scrollBy({ top: delta, behavior: "smooth" });
    }
    $("btnScrollDown").addEventListener("click", () => scrollLetter(220));
    $("btnScrollUp").addEventListener("click", () => scrollLetter(-220));

    function updateScrollButtons(){
      if(!letterContent) return;
      const up = $("btnScrollUp");
      const down = $("btnScrollDown");
      const atTop = letterContent.scrollTop <= 2;
      const atBottom = letterContent.scrollTop + letterContent.clientHeight >= letterContent.scrollHeight - 2;

      up.style.opacity = atTop ? 0.35 : 1;
      down.style.opacity = atBottom ? 0.35 : 1;
    }
    if(letterContent){
      letterContent.addEventListener("scroll", updateScrollButtons);
      updateScrollButtons();
    }
  </script>
</body>
</html>
