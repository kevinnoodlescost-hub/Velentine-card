<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thi·ªáp Valentine</title>

  <style>
    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --cardW: min(860px, calc(100vw - 28px));
      --radius: clamp(14px, 2.8vw, 22px);
      --pad: clamp(16px, 3.8vw, 36px);
      --h1: clamp(22px, 3.6vw, 36px);
      --h2: clamp(18px, 3vw, 28px);
      --p:  clamp(14px, 2.1vw, 18px);
      --btn: clamp(14px, 2.1vw, 16px);
      --shadow: 0 12px 34px rgba(0,0,0,0.22);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      text-align:center;
    }

    /* L·ªõp n·ªÅn tim (kh√¥ng ƒë√® n·ªôi dung ch√≠nh) */
    .heart{
      position:fixed;
      z-index:1;
      pointer-events:none;
      opacity:0;
      will-change:transform, opacity;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
    }
    @keyframes floatUp{
      0%   { transform: translate(var(--x0), 110vh) rotate(0deg); opacity:0; }
      12%  { opacity:1; }
      100% { transform: translate(var(--x1), -20vh) rotate(360deg); opacity:0; }
    }

    /* Stage */
    .stage{
      position:relative;
      z-index:3;
      width:var(--cardW);
    }

    /* Card chung */
    .panel{
      background:#fff;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:var(--pad);
      margin: 0 auto;
    }

    .title{
      font-size:var(--h1);
      margin:0 0 10px 0;
      line-height:1.15;
    }
    .subtitle{
      font-size:var(--h2);
      margin:0 0 12px 0;
      line-height:1.25;
    }
    .text{
      font-size:var(--p);
      line-height:1.7;
      margin:0 0 14px 0;
    }

    .btnRow{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      border:none;
      border-radius:999px;
      padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4.2vw, 26px);
      font-size:var(--btn);
      cursor:pointer;
      color:#fff;
      background:#ff4d6d;
      transition: transform .08s ease, opacity .2s ease;
    }
    button:hover{ opacity:.92; }
    button:active{ transform: translateY(1px); }

    .btnGhost{
      background:#111;
      opacity:.85;
    }

    /* ·∫®n/hi·ªán scene */
    .scene{ display:none; }
    .scene.active{ display:block; }

    /* ====== Envelope (Phong b√¨ + tem) ====== */
    .envelopeWrap{
      display:grid;
      place-items:center;
      gap:16px;
    }

    .envelope{
      width: min(520px, 92vw);
      aspect-ratio: 16/10;
      position:relative;
      border-radius:18px;
      background: #f7f2ee;
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
      overflow:hidden;
    }

    /* th√¢n phong b√¨ */
    .env-body{
      position:absolute; inset:0;
      background: linear-gradient(180deg, #fff 0%, #f6efe9 100%);
    }

    /* n·∫Øp phong b√¨ */
    .env-flap{
      position:absolute;
      left:0; right:0;
      top:-10%;
      height:65%;
      background: linear-gradient(180deg, #f0e6df 0%, #e9ddd4 100%);
      clip-path: polygon(0 0, 100% 0, 50% 80%);
      transform-origin: 50% 0%;
      transition: transform .9s ease;
    }

    /* tem */
    .stamp{
      position:absolute;
      right:6%;
      top:10%;
      width: clamp(56px, 10vw, 86px);
      aspect-ratio: 1/1.15;
      border-radius:10px;
      background: #ffefef;
      border: 2px dashed rgba(0,0,0,0.18);
      display:grid;
      place-items:center;
      font-weight:700;
      color:#ff4d6d;
      transform: rotate(7deg);
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      user-select:none;
    }

    /* con d·∫•u ƒë√≥ng */
    .seal{
      position:absolute;
      left:50%;
      top:62%;
      transform: translate(-50%,-50%);
      width: clamp(44px, 8vw, 64px);
      height: clamp(44px, 8vw, 64px);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ff97aa, #ff4d6d);
      box-shadow: inset 0 0 0 4px rgba(255,255,255,0.55);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:800;
      user-select:none;
    }

    /* l√° th∆∞ b√™n trong */
    .letter{
      position:absolute;
      left:6%;
      right:6%;
      bottom:-56%;
      height:82%;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.18);
      padding: clamp(14px, 3vw, 22px);
      text-align:left;
      transition: transform 1s ease;
    }

    .letter h3{
      margin:0 0 8px 0;
      font-size: clamp(16px, 2.6vw, 20px);
    }
    .letter p{
      margin:0;
      font-size: clamp(13px, 2.1vw, 16px);
      line-height:1.65;
    }
    .letter .sig{
      margin-top: 10px;
      font-weight:700;
    }

    /* tr·∫°ng th√°i m·ªü */
    .open .env-flap{ transform: rotateX(180deg); }
    .open .letter{ transform: translateY(-58%); }

    /* ====== Map scene ====== */
    .mapGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: clamp(12px, 2.8vw, 18px);
      align-items:stretch;
      text-align:left;
      margin-top: 10px;
    }
    .mapBox{
      background:#fff;
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
      min-height: clamp(220px, 40vh, 360px);
    }
    iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
    .context{
      background: rgba(255,255,255,0.78);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.10);
    }
    .context .k{
      font-weight:800;
      margin:0 0 10px 0;
      font-size: clamp(16px, 2.4vw, 20px);
    }

    /* Mobile: map x·∫øp d·ªçc */
    @media (max-width: 820px){
      .mapGrid{ grid-template-columns: 1fr; }
      .context{ text-align:left; }
    }

    /* ·∫¢nh cu·ªëi */
    .photo{
      display:block;
      width: clamp(210px, 52vw, 360px);
      max-width:100%;
      height:auto;
      margin: 14px auto 0 auto;
      border-radius: clamp(12px, 2.4vw, 18px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
    }

    /* gi·∫£m chuy·ªÉn ƒë·ªông n·∫øu ng∆∞·ªùi d√πng y√™u c·∫ßu */
    @media (prefers-reduced-motion: reduce){
      .heart{ animation:none; opacity:0; }
      .env-flap, .letter{ transition:none; }
    }
  </style>
</head>

<body>
  <!-- Audio: b·∫°n upload file music.mp3 c√πng th∆∞ m·ª•c -->
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <div class="stage">

    <!-- SCENE 1: Envelope -->
    <section id="sceneEnvelope" class="scene active">
      <div class="panel envelopeWrap">
        <h1 class="title">üì¨ A Letter For B√© K·ªãt</h1>
        <p class="text">C√≥ m·ªôt l√° th∆∞ nh·ªè‚Ä¶ Anh mu·ªën b√© m·ªü ra theo c√°ch ‚Äúƒë√∫ng ki·ªÉu th∆∞ tay‚Äù.</p>

        <div id="envelope" class="envelope" aria-label="Phong b√¨ th∆∞">
          <div class="env-body"></div>
          <div class="env-flap"></div>

          <div class="stamp">LOVE<br>STAMP</div>
          <div class="seal">üíå</div>

          <div class="letter">
            <h3>G·ª≠i b√© K·ªãt,</h3>
            <p>
              V·∫≠y l√† m√¨nh ƒë√£ ƒëi c√πng nhau ƒë∆∞·ª£c 4 th√°ng. C√≥ l√∫c vui, c√≥ l√∫c kh√¥ng d·ªÖ,
              nh∆∞ng ƒëi·ªÅu anh ch·∫Øc nh·∫•t l√†: anh v·∫´n mu·ªën n·∫Øm tay b√© v√† c√πng ƒëi ti·∫øp.<br><br>
              H√¥m nay anh vi·∫øt l√° th∆∞ n√†y ƒë·ªÉ h·ªèi m·ªôt ƒëi·ªÅu ƒë∆°n gi·∫£n th√¥i‚Ä¶
            </p>
            <p class="sig">‚Äî Anh</p>
          </div>
        </div>

        <div class="btnRow">
          <button id="btnOpen">M·ªü th∆∞ ‚úâÔ∏è</button>
        </div>
      </div>
    </section>

    <!-- SCENE 2: Ask -->
    <section id="sceneAsk" class="scene">
      <div class="panel">
        <h2 class="subtitle">B√© c√≥ ƒë·ªìng √Ω l√†m Valentine c·ªßa anh kh√¥ng? üíñ</h2>
        <p class="text">
          Kh√¥ng ch·ªâ nƒÉm nay‚Ä¶ m√† n·∫øu b√© cho ph√©p, c·∫£ nh·ªØng nƒÉm sau n·ªØa.
        </p>
        <div class="btnRow">
          <button id="btnYes">ƒê·ªìng √Ω ‚úÖ</button>
          <button id="btnNo" class="btnGhost">ƒê·ªÉ b√© suy nghƒ© th√™m üò≥</button>
        </div>
        <p id="noHint" class="text" style="display:none; margin-top:12px;">
          Anh s·∫Ω ƒë·ª©ng ƒë√¢y ƒë·ª£i c√¢u tr·∫£ l·ªùi ‚Äúƒê·ªìng √Ω‚Äù ƒë√≥ nha üòÑ
        </p>
      </div>
    </section>

    <!-- SCENE 3: Map + Context -->
    <section id="sceneMap" class="scene">
      <div class="panel">
        <h2 class="subtitle">N∆°i m√¨nh g·∫∑p nhau l·∫ßn ƒë·∫ßu üìç</h2>
        <p class="text">
          B·∫£n ƒë·ªì ·ªü ƒë√¢y, c√≤n ‚Äúc√¢u chuy·ªán‚Äù th√¨ anh ƒë·ªÉ ngay b√™n c·∫°nh.
        </p>

        <div class="mapGrid">
          <div class="mapBox">
            <!-- TODO: thay LAT,LNG b·∫±ng t·ªça ƒë·ªô th·∫≠t -->
            <iframe
              id="mapFrame"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.5115795957554!2d106.65532687435655!3d10.77207498937643!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ec3c161a3fb%3A0xef77cd47a1cc691e!2sHCMC%20University%20of%20Technology%20(HCMUT)!5e0!3m2!1sen!2s!4v1770971711669!5m2!1sen!2s"
              title="B·∫£n ƒë·ªì n∆°i g·∫∑p nhau l·∫ßn ƒë·∫ßu">
            </iframe>
          </div>

          <div class="context">
            <p class="k">Chuy·ªán c·ªßa t·ª•i m√¨nh</p>
            <p class="text" style="margin:0;">
              <!-- TODO: thay n·ªôi dung k·ª∑ ni·ªám th·∫≠t c·ªßa b·∫°n -->
              Anh v·∫´n nh·ªõ kho·∫£nh kh·∫Øc ƒë√≥‚Äîm·ªôt cu·ªôc g·∫∑p r·∫•t ‚Äút√¨nh c·ªù‚Äù nh∆∞ng l·∫°i th√†nh ‚Äúƒë·ªãnh m·ªánh‚Äù.
              C√≥ th·ªÉ b√© kh√¥ng nh·ªõ t·ª´ng chi ti·∫øt, nh∆∞ng v·ªõi anh, ƒë√≥ l√† ng√†y m·ªçi th·ª© b·∫Øt ƒë·∫ßu c√≥ √Ω nghƒ©a h∆°n.
              <br><br>
              V√† anh mu·ªën m√¨nh c√≥ th√™m th·∫≠t nhi·ªÅu ‚Äúƒëi·ªÉm ƒë√°nh d·∫•u‚Äù nh∆∞ v·∫≠y‚Äîc√πng nhau.
            </p>

            <div class="btnRow" style="justify-content:flex-start; margin-top:14px;">
              <button id="btnToFinal">ƒêi ti·∫øp üëâ</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SCENE 4: Final (gi·ªØ tinh th·∫ßn code c≈©) -->
    <section id="sceneFinal" class="scene">
      <div class="panel" id="finalCard">
        <h2 class="subtitle">Happy Valentine ‚ù§Ô∏è</h2>
        <p class="text">
          Anh th∆∞∆°ng b√© K·ªãt r·∫•t nhi·ªÅu. <br>
          C·∫£m ∆°n v√¨ ƒë√£ ƒë·ªìng h√†nh c√πng anh nha b√© v√† mong l√† t·ª•i m√¨nh
          s·∫Ω ƒë·ªìng h√†nh c√πng nhau l√¢u th·∫≠t l√† l√¢u n√®
        </p>
        <img class="photo" src="·∫£nh ƒë√¥i.jpg" alt="·∫¢nh ƒë√¥i">
      </div>
    </section>

  </div>

  <script>
    // ===== Helpers =====
    const $ = (id) => document.getElementById(id);
    const sceneEnvelope = $("sceneEnvelope");
    const sceneAsk = $("sceneAsk");
    const sceneMap = $("sceneMap");
    const sceneFinal = $("sceneFinal");
    const envelope = $("envelope");
    const bgm = $("bgm");

    function showScene(scene){
      for (const s of [sceneEnvelope, sceneAsk, sceneMap, sceneFinal]) s.classList.remove("active");
      scene.classList.add("active");
    }

    // ===== Audio play (needs user gesture) =====
    async function tryPlayMusic(){
      try{
        // m·ªôt s·ªë tr√¨nh duy·ªát c·∫ßn volume nh·ªè tr∆∞·ªõc
        bgm.volume = 0.85;
        await bgm.play();
      }catch(e){
        // n·∫øu v·∫´n b·ªã ch·∫∑n, b·ªè qua (ng∆∞·ªùi d√πng c√≥ th·ªÉ b·∫≠t th·ªß c√¥ng)
        console.log("Autoplay blocked:", e);
      }
    }

    // ===== Hearts: spawn kh·∫Øp m√†n h√¨nh nh∆∞ng tr√°nh v√πng n·ªôi dung ch√≠nh =====
    function rand(min, max){ return Math.random() * (max - min) + min; }

    function getNoSpawnZone(){
      const activePanel = document.querySelector(".scene.active .panel");
      const r = activePanel.getBoundingClientRect();
      const pad = Math.max(16, Math.round(Math.min(innerWidth, innerHeight) * 0.05));
      return { left:r.left-pad, right:r.right+pad, top:r.top-pad, bottom:r.bottom+pad };
    }

    function pickSpawnPoint(){
      const z = getNoSpawnZone();
      const W = innerWidth, H = innerHeight;

      for(let i=0;i<14;i++){
        const x = rand(0, W);
        const y = rand(0, H);
        const inside = (x>=z.left && x<=z.right && y>=z.top && y<=z.bottom);
        if(!inside) return {x,y};
      }
      return {x: rand(0,W), y: rand(0,40)};
    }

    function spawnHeart(){
      const {x,y} = pickSpawnPoint();
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = "‚ù§Ô∏è";

      // size responsive
      const minSize = Math.max(16, Math.min(innerWidth, innerHeight) * 0.028);
      const maxSize = Math.max(26, Math.min(innerWidth, innerHeight) * 0.052);
      const size = rand(minSize, maxSize);
      heart.style.fontSize = size + "px";

      heart.style.left = x + "px";
      heart.style.top  = y + "px";

      const drift = rand(-50, 50);
      heart.style.setProperty("--x0", "0px");
      heart.style.setProperty("--x1", drift + "px");

      const isMobile = matchMedia("(max-width: 600px)").matches;
      const duration = isMobile ? rand(5.8, 7.8) : rand(6.2, 9.2);
      heart.style.animationDuration = duration + "s";

      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), duration * 1000 + 200);
    }

    const isMobile = matchMedia("(max-width: 600px)").matches;
    setInterval(spawnHeart, isMobile ? 650 : 450);

    // ===== Flow =====
    $("btnOpen").addEventListener("click", async () => {
      envelope.classList.add("open");
      await tryPlayMusic();            // nh·∫°c b·∫Øt ƒë·∫ßu khi m·ªü th∆∞
      setTimeout(() => showScene(sceneAsk), 1100);
    });

    $("btnNo").addEventListener("click", () => {
      $("noHint").style.display = "block";
    });

    $("btnYes").addEventListener("click", () => {
      showScene(sceneMap);
    });

    $("btnToFinal").addEventListener("click", () => {
      showScene(sceneFinal);
    });
  </script>
</body>
</html>
