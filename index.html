<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thi·ªáp Valentine</title>

  <style>
    :root{
      --bg1:#ff9a9e;
      --bg2:#fad0c4;
      --cardW: min(860px, calc(100vw - 28px));
      --radius: clamp(14px, 2.8vw, 22px);
      --pad: clamp(16px, 3.8vw, 36px);
      --h1: clamp(22px, 3.6vw, 36px);
      --h2: clamp(18px, 3vw, 28px);
      --p:  clamp(14px, 2.1vw, 18px);
      --btn: clamp(14px, 2.1vw, 16px);
      --shadow: 0 12px 34px rgba(0,0,0,0.22);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      text-align:center;
    }

    /* Tim n·ªÅn */
    .heart{
      position:fixed;
      z-index:1;
      pointer-events:none;
      opacity:0;
      will-change:transform, opacity;
      animation: floatUp linear forwards;
      filter: drop-shadow(0 4px 10px rgba(0,0,0,0.18));
    }
    @keyframes floatUp{
      0%   { transform: translate(var(--x0), 110vh) rotate(0deg); opacity:0; }
      12%  { opacity:1; }
      100% { transform: translate(var(--x1), -20vh) rotate(360deg); opacity:0; }
    }

    .stage{ position:relative; z-index:3; width:var(--cardW); }

    .panel{
      background:#fff;
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:var(--pad);
      margin: 0 auto;
    }

    .title{ font-size:var(--h1); margin:0 0 10px 0; line-height:1.15; }
    .subtitle{ font-size:var(--h2); margin:0 0 12px 0; line-height:1.25; }
    .text{ font-size:var(--p); line-height:1.7; margin:0 0 14px 0; }

    .btnRow{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    button{
      border:none;
      border-radius:999px;
      padding: clamp(10px, 2.5vw, 12px) clamp(16px, 4.2vw, 26px);
      font-size:var(--btn);
      cursor:pointer;
      color:#fff;
      background:#ff4d6d;
      transition: transform .08s ease, opacity .2s ease;
    }
    button:hover{ opacity:.92; }
    button:active{ transform: translateY(1px); }

    .btnGhost{ background:#111; opacity:.85; }

    .scene{ display:none; }
    .scene.active{ display:block; }

    /* ===== Envelope ===== */
    .envelopeWrap{
      display:grid;
      place-items:center;
      gap:16px;
    }

    .envelope{
      width: min(520px, 92vw);
      aspect-ratio: 16/10;
      position:relative;
      border-radius:18px;
      background: #f7f2ee;
      box-shadow: 0 10px 26px rgba(0,0,0,0.18);
      overflow:hidden;
    }

    .env-body{
      position:absolute; inset:0;
      background: linear-gradient(180deg, #fff 0%, #f6efe9 100%);
    }

    .env-flap{
      position:absolute;
      left:0; right:0;
      top:-10%;
      height:65%;
      background: linear-gradient(180deg, #f0e6df 0%, #e9ddd4 100%);
      clip-path: polygon(0 0, 100% 0, 50% 80%);
      transform-origin: 50% 0%;
      transition: transform .9s ease;
    }

    /* Stamp b·∫±ng ·∫£nh */
    .stamp{
      position:absolute;
      right:6%;
      top:10%;
      width: clamp(56px, 10vw, 92px);
      aspect-ratio: 1/1.15;
      border-radius:12px;
      overflow:hidden;
      transform: rotate(7deg);
      box-shadow: 0 8px 18px rgba(0,0,0,0.15);
      user-select:none;
      background:#fff;
    }
    .stamp img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .seal{
      position:absolute;
      left:50%;
      top:62%;
      transform: translate(-50%,-50%);
      width: clamp(44px, 8vw, 64px);
      height: clamp(44px, 8vw, 64px);
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, #ff97aa, #ff4d6d);
      box-shadow: inset 0 0 0 4px rgba(255,255,255,0.55);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:800;
      user-select:none;
    }

    .letter{
      position:absolute;
      left:6%;
      right:6%;
      bottom:-56%;
      height:82%;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.18);
      padding: clamp(14px, 3vw, 22px);
      text-align:left;
      transition: transform 1s ease;
      overflow:hidden; /* ‚úÖ ƒë·ªÉ n√∫t cu·ªôn n·∫±m g·ªçn trong th∆∞ */
    }

    /* ‚úÖ Khung cu·ªôn n·ªôi dung b√™n trong th∆∞ */
    .letterContent{
      height: 100%;
      overflow:auto;
      padding-right: 6px; /* ch·ª´a ch·ªó scrollbar */
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
    }
    /* T√πy ch·ªçn: scrollbar ƒë·∫πp nh·∫π (Chrome/Edge) */
    .letterContent::-webkit-scrollbar{ width:8px; }
    .letterContent::-webkit-scrollbar-thumb{
      background: rgba(255,77,109,0.35);
      border-radius: 99px;
    }

    .letter h3{ margin:0 0 8px 0; font-size: clamp(16px, 2.6vw, 20px); }
    .letter p{ margin:0 0 12px 0; font-size: clamp(13px, 2.1vw, 16px); line-height:1.65; }
    .letter .sig{ margin-top: 10px; font-weight:700; }

    .open .env-flap{ transform: rotateX(180deg); }
    .open .letter{ transform: translateY(-58%); }

    /* N√∫t xu·∫•t hi·ªán sau khi m·ªü th∆∞ */
    #btnContinue{ display:none; }
    .opened #btnContinue{ display:inline-block; }

    /* ‚úÖ N√∫t cu·ªôn trong th∆∞ */
    .scrollBtns{
      position:absolute;
      right:10px;
      bottom:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      z-index:5;
    }
    .scrollBtn{
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: none;
      cursor:pointer;
      background: rgba(255,77,109,0.95);
      color:#fff;
      font-size:18px;
      line-height:40px;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      padding:0;
    }
    .scrollBtn:active{ transform: translateY(1px); }

    /* ·∫®n n√∫t khi ch∆∞a m·ªü th∆∞ */
    .scrollBtns{ opacity:0; transform: translateY(6px); pointer-events:none; transition: .2s ease; }
    .open .scrollBtns{ opacity:1; transform:none; pointer-events:auto; }

    /* Map */
    .mapGrid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: clamp(12px, 2.8vw, 18px);
      align-items:stretch;
      text-align:left;
      margin-top: 10px;
    }
    .mapBox{
      background:#fff;
      border-radius: 16px;
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
      min-height: clamp(220px, 40vh, 360px);
    }
    iframe{ width:100%; height:100%; border:0; display:block; }
    .context{
      background: rgba(255,255,255,0.78);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 26px rgba(0,0,0,0.10);
    }
    .context .k{
      font-weight:800;
      margin:0 0 10px 0;
      font-size: clamp(16px, 2.4vw, 20px);
    }
    @media (max-width: 820px){
      .mapGrid{ grid-template-columns: 1fr; }
      .context{ text-align:left; }
    }

    .photo{
      display:block;
      width: clamp(210px, 52vw, 360px);
      max-width:100%;
      height:auto;
      margin: 14px auto 0 auto;
      border-radius: clamp(12px, 2.4vw, 18px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.14);
    }

    @media (prefers-reduced-motion: reduce){
      .heart{ animation:none; opacity:0; }
      .env-flap, .letter{ transition:none; }
      .letterContent{ scroll-behavior:auto; }
    }
  </style>
</head>

<body>
  <audio id="bgm" src="music.mp3" preload="auto" loop></audio>

  <div class="stage">

    <!-- SCENE 1 -->
    <section id="sceneEnvelope" class="scene active">
      <div class="panel envelopeWrap" id="envPanel">
        <h1 class="title">üì¨ A Letter For B√© K·ªãt</h1>
        <p class="text">C√≥ m·ªôt l√° th∆∞ nh·ªè‚Ä¶ Anh mu·ªën b√© m·ªü ra theo c√°ch ‚Äúƒë√∫ng ki·ªÉu th∆∞ tay‚Äù.</p>

        <div id="envelope" class="envelope" aria-label="Phong b√¨ th∆∞">
          <div class="env-body"></div>
          <div class="env-flap"></div>

          <div class="stamp" aria-label="Love stamp">
            <img src="love stamp.jpg" alt="Love stamp">
          </div>

          <div class="seal">üíå</div>

          <div class="letter">
            <!-- ‚úÖ N·ªôi dung th∆∞ cu·ªôn ƒë∆∞·ª£c -->
            <div id="letterContent" class="letterContent">
              <h3>G·ª≠i b√© K·ªãt,</h3>
              <p>
                V·∫≠y l√† m√¨nh ƒë√£ ƒëi c√πng nhau ƒë∆∞·ª£c 4 th√°ng. C√≥ l√∫c vui, c√≥ l√∫c kh√¥ng d·ªÖ,
                nh∆∞ng ƒëi·ªÅu anh ch·∫Øc nh·∫•t l√†: anh v·∫´n mu·ªën n·∫Øm tay b√© v√† c√πng ƒëi ti·∫øp.
              </p>

              <p>
                H√¥m nay anh vi·∫øt l√° th∆∞ n√†y ƒë·ªÉ n√≥i nhi·ªÅu h∆°n m·ªôt ch√∫t‚Ä¶ (b√© c√≥ th·ªÉ k√©o/scroll ƒë·ªÉ ƒë·ªçc ti·∫øp nha)
              </p>

              <!-- ‚úÖ B·∫°n c·ª© vi·∫øt d√†i th√™m tho·∫£i m√°i -->
              <p>
                [Vi·∫øt ti·∫øp ·ªü ƒë√¢y‚Ä¶] Anh th√≠ch c√°ch b√© c∆∞·ªùi, c√°ch b√© quan t√¢m nh·ªØng ƒëi·ªÅu nh·ªè.
                C√≥ nh·ªØng ng√†y m·ªát, ch·ªâ c·∫ßn nghe b√© n√≥i v√†i c√¢u l√† anh th·∫•y b√¨nh y√™n h∆°n.
              </p>

              <p>
                [Vi·∫øt ti·∫øp‚Ä¶] D√π t·ª•i m√¨nh c√≥ l√∫c kh√¥ng c√πng nh·ªãp, anh v·∫´n mu·ªën h·ªçc c√°ch y√™u b√© ƒë√∫ng h∆°n,
                ki√™n nh·∫´n h∆°n, v√† t·ª≠ t·∫ø h∆°n.
              </p>

              <p>
                [Vi·∫øt ti·∫øp‚Ä¶] V√† n·∫øu b√© cho ph√©p, anh mu·ªën m√¨nh c√≥ th√™m th·∫≠t nhi·ªÅu k·ª∑ ni·ªám m·ªõi,
                ƒë·ªÉ sau n√†y nh√¨n l·∫°i, t·ª•i m√¨nh th·∫•y ‚Äú√†, ho√° ra t·ª•i m√¨nh ƒë√£ c·ªë g·∫Øng v√¨ nhau nhi·ªÅu nh∆∞ v·∫≠y.‚Äù
              </p>

              <p class="sig">‚Äî Anh</p>
              <div style="height:10px"></div>
            </div>

            <!-- ‚úÖ N√∫t cu·ªôn trong th∆∞ -->
            <div class="scrollBtns" aria-label="N√∫t cu·ªôn th∆∞">
              <button id="btnScrollDown" class="scrollBtn" title="Cu·ªôn xu·ªëng">‚Üì</button>
              <button id="btnScrollUp" class="scrollBtn" title="Cu·ªôn l√™n">‚Üë</button>
            </div>
          </div>
        </div>

        <div class="btnRow">
          <button id="btnOpen">M·ªü th∆∞ ‚úâÔ∏è</button>
          <button id="btnContinue" class="btnGhost">ƒê·ªçc xong r·ªìi üëâ</button>
        </div>
      </div>
    </section>

    <!-- SCENE 2 -->
    <section id="sceneAsk" class="scene">
      <div class="panel">
        <h2 class="subtitle">B√© c√≥ ƒë·ªìng √Ω l√†m Valentine c·ªßa anh kh√¥ng? üíñ</h2>
        <p class="text">Kh√¥ng ch·ªâ nƒÉm nay‚Ä¶ m√† n·∫øu b√© cho ph√©p, c·∫£ nh·ªØng nƒÉm sau n·ªØa.</p>
        <div class="btnRow">
          <button id="btnYes">ƒê·ªìng √Ω ‚úÖ</button>
          <button id="btnNo" class="btnGhost">ƒê·ªÉ b√© suy nghƒ© th√™m üò≥</button>
        </div>
        <p id="noHint" class="text" style="display:none; margin-top:12px;">
          Anh s·∫Ω ƒë·ª©ng ƒë√¢y ƒë·ª£i c√¢u tr·∫£ l·ªùi ‚Äúƒê·ªìng √Ω‚Äù ƒë√≥ nha üòÑ
        </p>
      </div>
    </section>

    <!-- SCENE 3 -->
    <section id="sceneMap" class="scene">
      <div class="panel">
        <h2 class="subtitle">N∆°i m√¨nh g·∫∑p nhau l·∫ßn ƒë·∫ßu üìç</h2>
        <p class="text">B·∫£n ƒë·ªì ·ªü ƒë√¢y, c√≤n ‚Äúc√¢u chuy·ªán‚Äù th√¨ anh ƒë·ªÉ ngay b√™n c·∫°nh.</p>

        <div class="mapGrid">
          <div class="mapBox">
            <iframe
              id="mapFrame"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3919.5115795957554!2d106.65532687435655!3d10.77207498937643!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x31752ec3c161a3fb%3A0xef77cd47a1cc691e!2sHCMC%20University%20of%20Technology%20(HCMUT)!5e0!3m2!1sen!2s!4v1770971711669!5m2!1sen!2s"
              title="B·∫£n ƒë·ªì n∆°i g·∫∑p nhau l·∫ßn ƒë·∫ßu">
            </iframe>
          </div>

          <div class="context">
            <p class="k">Chuy·ªán c·ªßa t·ª•i m√¨nh</p>
            <p class="text" style="margin:0;">
              Anh v·∫´n nh·ªõ kho·∫£nh kh·∫Øc ƒë√≥‚Äîm·ªôt cu·ªôc g·∫∑p r·∫•t ‚Äút√¨nh c·ªù‚Äù nh∆∞ng l·∫°i th√†nh ‚Äúƒë·ªãnh m·ªánh‚Äù.
              C√≥ th·ªÉ b√© kh√¥ng nh·ªõ t·ª´ng chi ti·∫øt, nh∆∞ng v·ªõi anh, ƒë√≥ l√† ng√†y m·ªçi th·ª© b·∫Øt ƒë·∫ßu c√≥ √Ω nghƒ©a h∆°n.
              <br><br>
              V√† anh mu·ªën m√¨nh c√≥ th√™m th·∫≠t nhi·ªÅu ‚Äúƒëi·ªÉm ƒë√°nh d·∫•u‚Äù nh∆∞ v·∫≠y‚Äîc√πng nhau.
            </p>
            <div class="btnRow" style="justify-content:flex-start; margin-top:14px;">
              <button id="btnToFinal">ƒêi ti·∫øp üëâ</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- SCENE 4 -->
    <section id="sceneFinal" class="scene">
      <div class="panel" id="finalCard">
        <h2 class="subtitle">Happy Valentine ‚ù§Ô∏è</h2>
        <p class="text">
          Anh th∆∞∆°ng b√© K·ªãt r·∫•t nhi·ªÅu. <br>
          C·∫£m ∆°n v√¨ ƒë√£ ƒë·ªìng h√†nh c√πng anh nha b√© v√† mong l√† t·ª•i m√¨nh
          s·∫Ω ƒë·ªìng h√†nh c√πng nhau l√¢u th·∫≠t l√† l√¢u n√®
        </p>
        <img class="photo" src="·∫£nh ƒë√¥i.jpg" alt="·∫¢nh ƒë√¥i">
      </div>
    </section>

  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const sceneEnvelope = $("sceneEnvelope");
    const sceneAsk = $("sceneAsk");
    const sceneMap = $("sceneMap");
    const sceneFinal = $("sceneFinal");
    const envelope = $("envelope");
    const bgm = $("bgm");
    const envPanel = $("envPanel");
    const letterContent = $("letterContent");

    function showScene(scene){
      for (const s of [sceneEnvelope, sceneAsk, sceneMap, sceneFinal]) s.classList.remove("active");
      scene.classList.add("active");
    }

    async function tryPlayMusic(){
      try{
        bgm.volume = 0.85;
        await bgm.play();
      }catch(e){
        console.log("Autoplay blocked:", e);
      }
    }

    // Hearts tr√°nh ƒë√® panel
    function rand(min, max){ return Math.random() * (max - min) + min; }

    function getNoSpawnZone(){
      const activePanel = document.querySelector(".scene.active .panel");
      const r = activePanel.getBoundingClientRect();
      const pad = Math.max(16, Math.round(Math.min(innerWidth, innerHeight) * 0.05));
      return { left:r.left-pad, right:r.right+pad, top:r.top-pad, bottom:r.bottom+pad };
    }

    function pickSpawnPoint(){
      const z = getNoSpawnZone();
      const W = innerWidth, H = innerHeight;
      for(let i=0;i<14;i++){
        const x = rand(0, W);
        const y = rand(0, H);
        const inside = (x>=z.left && x<=z.right && y>=z.top && y<=z.bottom);
        if(!inside) return {x,y};
      }
      return {x: rand(0,W), y: rand(0,40)};
    }

    function spawnHeart(){
      const {x,y} = pickSpawnPoint();
      const heart = document.createElement("div");
      heart.className = "heart";
      heart.textContent = "‚ù§Ô∏è";

      const minSize = Math.max(16, Math.min(innerWidth, innerHeight) * 0.028);
      const maxSize = Math.max(26, Math.min(innerWidth, innerHeight) * 0.052);
      heart.style.fontSize = rand(minSize, maxSize) + "px";

      heart.style.left = x + "px";
      heart.style.top  = y + "px";

      const drift = rand(-50, 50);
      heart.style.setProperty("--x0", "0px");
      heart.style.setProperty("--x1", drift + "px");

      const isMobile = matchMedia("(max-width: 600px)").matches;
      const duration = isMobile ? rand(5.8, 7.8) : rand(6.2, 9.2);
      heart.style.animationDuration = duration + "s";

      document.body.appendChild(heart);
      setTimeout(() => heart.remove(), duration * 1000 + 200);
    }

    const isMobile = matchMedia("(max-width: 600px)").matches;
    setInterval(spawnHeart, isMobile ? 650 : 450);

    // ===== Flow =====
    $("btnOpen").addEventListener("click", async () => {
      envelope.classList.add("open");
      envPanel.classList.add("opened");
      await tryPlayMusic();

      // ‚úÖ khi m·ªü th∆∞: ƒë∆∞a scroll v·ªÅ ƒë·∫ßu ƒë·ªÉ b√© ƒë·ªçc t·ª´ ƒë·∫ßu
      if(letterContent) letterContent.scrollTop = 0;
    });

    $("btnContinue").addEventListener("click", () => {
      showScene(sceneAsk);
    });

    $("btnNo").addEventListener("click", () => {
      $("noHint").style.display = "block";
    });

    $("btnYes").addEventListener("click", () => {
      showScene(sceneMap);
    });

    $("btnToFinal").addEventListener("click", () => {
      showScene(sceneFinal);
    });

    // ===== N√∫t cu·ªôn th∆∞ =====
    function scrollLetter(delta){
      if(!letterContent) return;
      letterContent.scrollBy({ top: delta, behavior: "smooth" });
    }

    $("btnScrollDown").addEventListener("click", () => scrollLetter(220));
    $("btnScrollUp").addEventListener("click", () => scrollLetter(-220));

    // (Tu·ª≥ ch·ªçn) ·∫®n/hi·ªán n√∫t theo v·ªã tr√≠ cu·ªôn
    function updateScrollButtons(){
      if(!letterContent) return;
      const up = $("btnScrollUp");
      const down = $("btnScrollDown");
      const atTop = letterContent.scrollTop <= 2;
      const atBottom = letterContent.scrollTop + letterContent.clientHeight >= letterContent.scrollHeight - 2;

      up.style.opacity = atTop ? 0.35 : 1;
      down.style.opacity = atBottom ? 0.35 : 1;
    }
    if(letterContent){
      letterContent.addEventListener("scroll", updateScrollButtons);
      updateScrollButtons();
    }
  </script>
</body>
</html>
